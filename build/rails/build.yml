apiVersion: v1
kind: Pod
metadata:
  name: rails-build-{{ rails_env }}
  labels:
    name: rails-build-{{ rails_env }}
spec:
  restartPolicy: Never
  containers:
    - image: gcr.io/kaniko-project/executor:latest
      name: kaniko
      args:
        - --destination={{ registry_url }}/rails:latest
        - --context=/rails/cloud/build/rails
        - --dockerfile=/Dockerfile
        - --build-arg=RAILS_ENV={{ rails_env }}
        - --cache
      env:
        - name: RAILS_ENV
          value: development
      volumeMounts:
        - mountPath: /rails
          name: rails
  volumes:
    - name: rails
      hostPath:
        path: {{ rails_path }}
